<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <script src="../js/jquery.js"></script>
  <link rel="stylesheet" href="../css/style.css">
  <title>Flight Planner</title>
</head>


<body id="page">
  <button id="theme_switcher">Dark theme</button>
  <div id="header">
    <div id="headerimg">
    </div>
  </div>

  <div class="card">
    <h2><a>Flight Planner</a></h2>

    <br><br>
    <button class="square_btn" id="connectbut">Connect</button>
    <img id="photoconnection" src="../images/button.png" height="50" width=50 style="margin:10px 0px -10px 10px">

    <br><br><br>
    <div class="tab">
      <button class="tablinks" onclick="openTab(event, 'flypathtab')">Fly path</button>
      <button class="tablinks" onclick="openTab(event, 'parameterstab')">Other parameters</button>
    </div>
    <div id="flypathtab" class="tabcontent">
      <h2>
        Rectangle width (d): <input id="rectwidthtext" type="number" value="500" onchange="computeMaxDistance()"> meters
        <br><br>
        Distance (P): <input id="distancetext" type="number" value=""> meters
        <br><br>
        Maximum distance (Pmax): <label id="maxdistancetext" type="number" value=></label> meters
        <br>
        <button class="square_btn_small" id="uploadbut" disabled>Load</button>

        <img id="photoupload" src="../images/button.png" height="50" width=50 style="margin:10px 0px -10px 10px">
      </h2>
    </div>
    <div id="parameterstab" class="tabcontent" style="display:none">
      <h2>
        x = <input id="xtext" type="number" value="500" onchange="computeMaxDistance()"> meters
        <br><br>
        L = <input id="Ltext" type="number" value="120" onchange="computeMaxDistance()"> meters
        <br><br>
        h = <input id="htext" type="number" value="120" onchange="computeMaxDistance()"> meters
      </h2>
    </div>

    <br><br><br>
    <button disabled class="square_btn" id="startbut">Start </button>
    <img id="photostart" src="../images/button.png" height="50" width=50 style="margin:10px 0px -10px 10px">

    <br><br><br>
    <button class="square_btn" id="getresultsbut">
      <a href="../results/History.html">Get results!</a>

    </button>

  </div>
  <script>
    var theme = 'DEFAULT'
    openTab(event, 'flypathtab');
    computeMaxDistance();

    function openTab(evt, id) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(id).style.display = "block";
    }

    function computeMaxDistance() {
      var x = document.getElementById("xtext").value;
      var l = document.getElementById("Ltext").value;
      var d = document.getElementById("rectwidthtext").value;
      var nmax = Math.floor((60000 - parseInt(x)) / (2 * parseInt(l) + parseInt(d)));
      var pmax = nmax * l;
      if (pmax <= 0) {
        document.getElementById("maxdistancetext").innerHTML = "0";
      }
      else {
        document.getElementById("maxdistancetext").innerHTML = pmax;
        console.log(nmax);
      }

    }



    $(document).ready(function () {
      $('#theme_switcher').on('click', themeSwitcher);

      $("#connectbut").click(function ()     
      {
        document.getElementById('photoconnection').src = "../images/waiting.png";
        $.ajax({
          type: 'GET',
          url: 'http://192.168.0.10:9000/api/connect',
          dataType: 'json',
          success: function (data, textStatus, xhr) {
            document.getElementById('photoconnection').src = "../images/tick.png";
            document.getElementById("uploadbut").disabled = false;
          },
          error: function (data, textStatus, xhr) {
            document.getElementById('photoconnection').src = "../images/cross.png";
          },
        })
      });

      $("#uploadbut").click(function ()       
      {
        document.getElementById('photoupload').src = "../images/waiting.png";
        var p = document.getElementById("distancetext").value;

        if (p != "") {
          var pnum = parseFloat(p);
          var maxdistancetext = $('#maxdistancetext');
          var pmax = parseFloat(maxdistancetext.text());
          var x = parseFloat(document.getElementById("xtext").value);
          var l = parseFloat(document.getElementById("Ltext").value);
          var h = parseFloat(document.getElementById("htext").value);
          var d = parseFloat(document.getElementById("rectwidthtext").value);
  
          if (pnum < pmax) {
            $.ajax
              ({
                type: 'POST',
                url: 'http://192.168.0.10:9000/api/load/:distance',
                data: { data1: pnum, data2: pmax, data3: x, data4: l, data5: h, data6: d },
                dataType: 'json',
                success: function (data, textStatus, xhr) {
                  document.getElementById('photoupload').src = "tick.jpg";
                  document.getElementById("startbut").disabled = false;
                },
                error: function (data, textStatus, xhr) {
                  document.getElementById('photoupload').src = "cross.jpg";
                },
              })
          }
        }
      });

      $("#startbut").click(function () 
      {
        document.getElementById('photostart').src = "../images/waiting.png";
        $.ajax
          ({
            type: 'GET',
            url: 'http://192.168.0.10:9000/api/start',
            dataType: 'json',
            success: function (data, textStatus, xhr) {
              document.getElementById('photostart').src = "../images/tick.png";
            },
            error: function (data, textStatus, xhr) {
              document.getElementById('photostart').src = "../images/cross.png";
            },
          })
      });
    });

    function themeSwitcher() {
      var isDefaultTheme = theme === 'DEFAULT';
      if(isDefaultTheme){
        theme = 'HIGH_CONTRAST';

        $('body').addClass('HIGH_CONTRAST');
        $('#header').css('background-image', 'none');
        $('#theme_switcher').text('Light theme')
        return;
      }
      if(!isDefaultTheme){
        theme = 'DEFAULT';

        $('body').removeClass('HIGH_CONTRAST');
        $('#header').css('background-image', 'url("../images/FundationHemavLogo.png")');
        $('#theme_switcher').text('Dark theme')

        return;
      }
    }
  </script>
</body>

</html>