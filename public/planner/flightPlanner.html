<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <script src="../js/jquery.js"></script>
  <link rel="stylesheet" href="../css/style.css">
  <title>Fight Planner</title>
</head>

<body id="planner">

  <h1>Flight Planner</h1>

  <br><br>
  <button id="connectbut">Connect</button>
  <img id="photoconnection" src="" height="50" width=50>

  <br><br><br>
  <div class="tab">
    <button class="tablinks" onclick="openTab(event, 'flypathtab')">Fly path</button>
    <button class="tablinks" onclick="openTab(event, 'parameterstab')">Other parameters</button>
  </div>
  <div id="flypathtab" class="tabcontent">
    <p>
      Rectangle width (d): <input id="rectwidthtext" type="number" value="500" onchange="computeMaxDistance()"> meters
      <br><br>
      Distance (P): <input id="distancetext" type="number" value=""> meters
      <br><br>
      Maximum distance: <label id="maxdistancetext" type="number"></label> meters
      <br>
      <button disabled id="uploadbut">Load</button>
      <img id="photoupload" src="" height="50" width=50>
    </p>
  </div>
  <div id="parameterstab" class="tabcontent" style="display:none" >
    <p>
      x = <input id="xtext" type="number" value="500" onchange="computeMaxDistance()"> meters
      <br><br>
      L = <input id="Ltext" type="number" value="120" onchange="computeMaxDistance()"> meters
      <br><br>
      h = <input id="htext" type="number" value="120" onchange="computeMaxDistance()"> meters
    </p>
  </div>

  <br><br><br>
  <button disabled id="startbut">START </button>
  <img id="photostart" src="" height="50" width=50>

  <br><br><br>
  <button id="getresultsbut">Get results</button>

  <script>
    openTab(event,'flypathtab');
    computeMaxDistance();
    
    function openTab(evt, id)
    {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) 
      {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) 
      {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(id).style.display = "block";
    }

     function computeMaxDistance()
    {
      var x=document.getElementById("xtext").value;
      var l=document.getElementById("Ltext").value;
      var d=document.getElementById("rectwidthtext").value;
      var nmax= Math.floor((60000-parseInt(x))/(2*parseInt(l)+parseInt(d)));
      var pmax=nmax*l;
      if (pmax<=0) 
      {
        document.getElementById("maxdistancetext").innerHTML="0";
      }
      else 
      {document.getElementById("maxdistancetext").innerHTML=pmax;
      console.log(nmax);}
      
    } 

    

      $(document).ready(function () 
      {

        $("#connectbut").click(function ()        // click CONNECT
        {
          document.getElementById('photoconnection').src = "./waiting.jpeg";
          $.ajax({
            type: 'GET',
            url: 'http://192.168.1.85:9000/api/connect',
            dataType: 'json',
            success: function(data,textStatus, xhr){
              document.getElementById('photoconnection').src = "./tick.jpg";
              document.getElementById("uploadbut").disabled = false;
            },
            error: function(data,textStatus,xhr){
              document.getElementById('photoconnection').src = "./cross.jpg";
            },
          })
        });

        $("#uploadbut").click(function ()         // click LOAD
        {
          document.getElementById('photoupload').src = "waiting.jpeg";
          var x = document.getElementById("distancetext").value;

          if (x != "") 
          {
            var xnum = parseFloat(x);
            var xmax=parseFloat(document.getElementById("maxdistancetext").value);
            if (xnum < xmax) 
            {
              $.ajax
              ({
                type:'POST',
                url: 'http://192.168.0.10:9000/api/load/:distance',
                data: xnum, 
                dataType: 'json',
                success: function(data,textStatus, xhr)
                {
                  document.getElementById('photoupload').src = "tick.jpg";
                  document.getElementById("startbut").disabled = false;
                },
                error: function(data,textStatus,xhr)
                {
                  document.getElementById('photoupload').src = "cross.jpg";
                },
              })
            }
          }
        });

        $("#startbut").click(function ()          // click START
        {
          document.getElementById('photoupload').src = "waiting.jpeg";
          $.ajax
          ({
            type: 'GET',
            url: 'http://192.168.0.10:9000/api/start',
            dataType: 'json',
            success: function(data,textStatus, xhr)
            {
              document.getElementById('photostart').src = "tick.jpg";
            },
            error: function(data,textStatus,xhr)
            {
              document.getElementById('photostart').src = "cross.jpg";
            },
          })
        });

        $("#getresultsbut").click(function()      // click GET RESULTS
        {
          window.open("../results/History.html"); 
        })

    });
  </script>

</body>

</html>
