<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <script src="../js/jquery.js"></script>
  <script src="../js/jquery.MultiLanguage.min.js"></script>
  <link rel="stylesheet" href="../css/style.css">
  <title>dLocust APP</title>
</head>


<body id="page">
  <button id="theme_switcher">Dark theme</button>

  <div id="header">
    <div id="headerimg">
    </div>
  </div>

  <div id="titlePlanner">
    <h2 id="PlannerTitle">
      <div id="h-history-title"></div>
    </h2>
    <label id="USB-status"></label>

  </div>
  <h4 id="USB-status-desc">
    <div id="h-disk-desc"></div>
  </h4>
  <div id="popupUSBSpace" style="display: none;">
    <div class="content-popup">
      <div class="close"><a href="#" id="close"><img src="../images/cross.png" height="20" width="20" /></a></div>
      <div>
        <h2>
          <div id="h-popupUSBSpace-title"></div>
        </h2>
        <p>
        <div id="h-popupUSBSpace-desc"></div>
        </p>
        <div style="float:left; width:100%;">
        </div>
      </div>
    </div>
  </div>


  <div id="popupLoad" style="display: none;">
    <div class="content-popup">
      <div class="close"><a href="#" id="close"><img src="../images/cross.png" height="20" width="20" /></a></div>
      <div>
        <h2>
          <div id="h-popupLoad-title"></div>
        </h2>
        <p>
        <div id="h-popupLoad-desc"></div>
        </p>
        <div style="float:left; width:100%;">
        </div>
      </div>
    </div>
  </div>
  <div class="popup-overlay"></div>

  <br><br>
  <hr />
  <div id="dvTable">
    <table id="tablacompleta" class="table table-striped">
      <thead>
        <tr>
          <th id="h-hour"></th>
          <th id="h-typeofmission"></th>
          <th id="h-flightinfo"></th>
        </tr>
      </thead>
      <tbody id="historyTable">
      </tbody>
    </table>
  </div>
  <br><br>
  <button class="square_btn" id = "backupButton">
    <div id="h-backup"></div>
  </button>
  <br><br><br>
  <h2 id="h-flight-title"></h2>
  

  <br><br>
  <div id="rsTable">
    <table id="completeTableResults" class="table table-striped">
      <thead>
        <tr>
          <th id="h-id"></th>
          <th id="h-greenveg"></th>
          <th id="h-long"></th>
          <th id="h-lat"></th>
          <th id="h-image"></th>

        </tr>
      </thead>
      <tbody id="resultsTable">
      </tbody>
    </table>

  </div>

  <br><br>
  <button class="square_btn" onclick="window.location='/History'" target="_new">
    <div id="h-clear"></div>
  </button>
  <button class="square_btn" onclick="window.location='/planner'" target="_new">
    <div id="h-goPlanner"></div>
  </button>


  <select onchange="languageSelector();" id="languageSelector" class="language">
    <option value="en">English</option>
    <option value="ar">عرب</option>
  </select>


  


  <script>
    var theme = 'DEFAULT'
    let diskPercentage;


    $(document).ready(function () {       
      

      $.MultiLanguage('/history-language.json', 'en')
      var ipConnection = '192.168.0.10'
      fillHistoryTable(ipConnection);


      var promise = new Promise(function (resolve, reject) {
        $("#USB-status").empty();
        $("#USB-status").append("--")

        $.ajax({
          type: 'GET',
          url: 'http://' + ipConnection + ':9000/api/utilities/USBdiskSpace',
          dataType: 'json',
          success: function (data, textStatus, xhr) {
            value = round(((data.sizeSpace - data.freeSpace) / data.sizeSpace) * 100, 2)

            if (diskPercentage <= 1) {
              $("#USB-status").empty();
              $("#USB-status").append(value + " % ")

            } else {
              $("#USB-status").empty();
              $("#USB-status").append(value + " % ")
              $("#USB-status").css({

                "display": "inline - block",
                "position": "relative",
                "right": "-540px",
                "padding": "0.5em 1em",
                "background": "#e3cc0e",
                "color": "#FD0A0A",
                "border- radius": "10 %",
                "font - size": "18px"
              });
            }
            resolve(value)

          },
          error: function (data, textStatus, xhr) {
            $("#USB-status").empty();
            $("#USB-status").append("--")
            reject("error")
          },
        })

      })

      promise.then(function (data) {
        if (data >= 1) {
          console.log("wfhewoir")
        }
      }, function (err) {
        console.log(err)
      });


      $('#close').on('click', function () {
        $('#popupUSBSpace').fadeOut('slow');
        $('#popupLoad').fadeOut('slow');
        $('.popup-overlay').fadeOut('slow');

        return false;
      });

      $('#backupButton').on('click', function () {
        $('#popupUSBSpace').fadeIn('slow');
        $('.popup-overlay').fadeIn('slow');

      })


      $('#theme_switcher').on('click', themeSwitcher);

    })


    function fillHistoryTable(ipConnection) {
      $("#historyTable").html(""); //primero vacio la tabla existente

      $.ajax({
        type: 'GET',
        url: 'http://' + ipConnection + ':9000/results.json',
        dataType: 'json',
        success: function (data) {
          $.each(data, function (index, datos) {
            $("#historyTable").append("<tr><td>" + datos.id + "</td><td>" + datos.typeOfFlight + "</td><td><button id='" + index + "' type='button' class='square_btn' onclick='fillResultsTable(" + index + ")'>Vegetation Results</button><button id='" + index + "' type='button' class='square_btn' onclick='goToLocustFinder(" + index + ")'>Visual Results</button></td></tr>");

          });
        }
      })

    }



    function fillResultsTable(passId) {
      $("#resultsTable").html(""); //primero vacio la tabla existente

      var ipConnection = '192.168.0.10'

      $.ajax({
        type: 'GET',
        url: 'http://' + ipConnection + ':9000/results.json',
        dataType: 'json',
        success: function (data) {
          $.each(data[passId].GreenResults, function (index, datos) {
            console.log(datos);
            $("#resultsTable").append("<tr><td>" + datos.image_id + "</td><td>" + datos.percentage + "</td><td>" + datos.coordinates[0] + "</td><td>" + datos.coordinates[1] + "</td><td><a href=" + datos.image_path + ">Show image</a></td></tr>");
          });
        }
      })


    }

    function languageSelector() {

      var x = document.getElementById("languageSelector").value;
      console.log(x)
      $.MultiLanguage('/history-language.json', x)

    }

    function goToLocustFinder(passId) {
      window.location = '/locustFinder?' + passId
    }

    function themeSwitcher() {
      var isDefaultTheme = theme === 'DEFAULT';
      if (isDefaultTheme) {
        theme = 'HIGH_CONTRAST';

        $('body').addClass('HIGH_CONTRAST');
        //$('#header').css('background-image', 'none');
        $('#theme_switcher').text('Light theme')
        return;
      }
      if (!isDefaultTheme) {
        theme = 'DEFAULT';

        $('body').removeClass('HIGH_CONTRAST');
        //$('#header').css('background-image', 'url("../images/FundationHemavLogo.png")');
        $('#theme_switcher').text('Dark theme')

        return;
      }
    }

    function round(value, decimals) {
      return Number(Math.round(value + 'e' + decimals) + 'e-' + decimals);
    }



  </script>

</body>

</html>