<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../css/style.css">
    <title>Flight Planner</title>
</head>


<body id="page">
    <div id="header">
        <div id="headerimg">
        </div>
    </div>

    <script src="/jquery.js"></script>
    <!-- <script src="GetResults.js"></script>
  <script src="ThisResult.js"></script> -->
    <button id="theme_switcher">Dark theme</button>
    <h2><a>Locust Finder</a></h2>
    <br><br>
    <hr />
    <div id="viewPhoto" class="viewPhoto">
        <img id = "image" src="/results/photos/Test Flight/1.jpeg" height="398" width="776">
    </div>
    <div id="VideoController" class="VideoController">
        <div id="InsideVideoController" class="InsideVideoController">
            <div id="ButtonMinorLeft" class="ButtonMinorLeft">
                <button class="MinorButton" onclick="window.location='History.html'" target="_new"><</button>
            </div>
            <div id="ButtonMajorLeft" class="ButtonMajorLeft">
                <button id="ButtonMajorLeft" class="square_btn" target="_new"><<</button>
            </div>
            <div id="ButtonMajorRight" class="ButtonMajorRight">
                <button id="ButtonMajorRight" class="square_btn"  target="_new">>></button>
            </div>
            <div id="ButtonMinorRight" class="ButtonMinorRight">
                <button class="MinorButton" onclick="window.location='History.html'" target="_new">></button>
            </div>
        </div>

    </div>
    <script>
        $(document).ready(function () {
            var theme = 'DEFAULT'
            var index = 0;
            var freq = 50;
            var ipConnection = 'localhost'
            var videoJSON = getJSON(ipConnection);
            videoJSON.then(data => {
                console.log(data[0].results.length)

            })


            fillHistoryTable(ipConnection);
            $('#theme_switcher').on('click', themeSwitcher);

            $('#ButtonMajorRight').click(function () {
                var videoJSON = getJSON(ipConnection);

                videoJSON.then(data => {
                    
                    var pointer = Math.floor(data[0].results.length / freq)

                    if (index <= freq) {
                        if (index == 0) {
                            console.log(data[0].results[(pointer - 1) * 1].image_path + "+" + index)
                            $('#image').prop('src', data[0].results[(pointer - 1) * 1].image_path);
                            index = 2
                            console.log(index)
                        } else if (pointer * index > (Math.floor(data[0].results.length)) - 1) {
                            console.log(data[0].results[(Math.floor(data[0].results.length) - 1)].image_path + "+" + index)
                            $('#image').prop('src', data[0].results[(Math.floor(data[0].results.length) - 1)].image_path);
                            console.log(index)

                        } else {
                            console.log(data[0].results[(pointer) * index].image_path + "+" + index)
                            $('#image').prop('src', data[0].results[(pointer) * index].image_path);

                            index++
                            console.log(index)
                        }
                    } else {
                        index = freq
                        console.log(index)
                    }

                })
            });

            $('#ButtonMajorLeft').click(function () {
                var videoJSON = getJSON(ipConnection);

                videoJSON.then(data => {
                    var pointer = Math.floor(data[0].results.length / freq)
                    index--
                    console.log(index)

                    if (index >= 0) {
                        if (index == 0) {
                            console.log(data[0].results[0].image_path + "+" + index)
                            $('#image').prop('src', data[0].results[0].image_path);

                        } else {
                            console.log(data[0].results[(pointer) * (index-1)].image_path + "+" + index)
                            $('#image').prop('src', data[0].results[(pointer) * (index-1)].image_path);

                        }
                    } else {
                        index = 0
                    }

                })
            });

        })



        async function getJSON(ipConnection) {

            await $.ajax({
                type: 'GET',
                url: 'http://' + ipConnection + ':9000/videoResults.json',
                dataType: 'json',
                success: function (json) {
                    result = json;
                }
            })

            return result

        }

        function test(index) {

            console.log(index)

        }




        function fillHistoryTable(ipConnection) {
            $("#historyTable").html(""); //primero vacio la tabla existente

            $.ajax({
                type: 'GET',
                url: 'http://' + ipConnection + ':9000/results.json',
                dataType: 'json',
                success: function (data) {
                    $.each(data, function (index, datos) {
                        $("#historyTable").append("<tr><td>" + datos.id + "</td><td><button id='" + index + "' type='button' class='square_btn' onclick='fillResultsTable(" + index + ")'>GO!</button></td></tr>");
                    });
                }
            })

        }

        function fillResultsTable(passId) {
            $("#resultsTable").html(""); //primero vacio la tabla existente

            var ipConnection = 'localhost'

            $.ajax({
                type: 'GET',
                url: 'http://' + ipConnection + ':9000/results.json',
                dataType: 'json',
                success: function (data) {
                    $.each(data[passId].results, function (index, datos) {
                        console.log(datos);
                        $("#resultsTable").append("<tr><td>" + datos.image_id + "</td><td>" + datos.percentage + "</td><td>" + datos.coordinates[0] + "</td><td>" + datos.coordinates[1] + "</td><td><a href=" + datos.image_path + ">Show image</a></td></tr>");
                    });
                }
            })


        }

        function themeSwitcher() {
            var isDefaultTheme = theme === 'DEFAULT';
            if (isDefaultTheme) {
                theme = 'HIGH_CONTRAST';

                $('body').addClass('HIGH_CONTRAST');
                $('#header').css('background-image', 'none');
                $('#theme_switcher').text('Light theme')
                return;
            }
            if (!isDefaultTheme) {
                theme = 'DEFAULT';

                $('body').removeClass('HIGH_CONTRAST');
                $('#header').css('background-image', 'url("../images/FundationHemavLogo.png")');
                $('#theme_switcher').text('Dark theme')

                return;
            }
        }

    </script>

</body>

</html>